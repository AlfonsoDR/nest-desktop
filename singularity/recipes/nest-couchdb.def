Bootstrap: docker
From: ubuntu:18.04

%labels
  AUTHOR Sebastian Spreizer <spreizer@web.de>
  VERSION 1.0.0

%post
  apt-get update && apt-get install -y curl
  curl -L https://couchdb.apache.org/repo/bintray-pubkey.asc \ | apt-key add -
  echo "deb https://apache.bintray.com/couchdb-deb bionic main" \ | tee -a /etc/apt/sources.list.d/apache_couchdb_bionic.list
  apt-get install -y apache2 couchdb

  adduser --disabled-login --disabled-password --no-create-home couchdb

  chown -R couchdb:couchdb /usr/local/var/log/couchdb
  chown -R couchdb:couchdb /usr/local/var/lib/couchdb
  chown -R couchdb:couchdb /usr/local/var/run/couchdb

  ln -s /usr/local/etc/logrotate.d/couchdb /etc/logrotate.d/couchdb
  ln -s /usr/local/etc/init.d/couchdb /etc/init.d

  update-rc.d couchdb defaults
