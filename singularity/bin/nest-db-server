#!/bin/bash

pid() {
  pgrep -f 'pouchdb-server start'
}

status() {
  export pid=`nest-db-server pid`
  if [ $pid ]; then
    echo 'DB Server for NEST Desktop is running.'
  else
    echo 'DB Server for NEST Desktop is not running.'
  fi
}

start() {
  export pid=`nest-db-server pid`
  if [ $pid ]; then
    echo 'DB Server for NEST Desktop is already running.'
  else
    pouchdb-server start --dir $NESTDESKTOP_DATA_DIR/db
  fi
}

stop() {
  export pid=`nest-db-server pid`
  if [ $pid ]; then
    kill $pid
    echo 'DB Server for NEST Desktop has stopped.'
  fi
}

case "$1" in
  pid) pid ;;
  status)  status ;;
  start)   start ;;
  stop)    stop ;;
  restart) stop; start ;;
  *) echo "usage: $0 pid|status|start|stop|restart" >&2
     exit 1
     ;;
esac
