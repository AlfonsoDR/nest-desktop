<mat-menu #nodeMenu="matMenu" class="menu node-menu">
  <button mat-menu-item class="menu-item">
    <fa-icon class="menu-icon" [style.color]="color" icon="paint-brush"></fa-icon>
    <mcc-color-picker [selectedColor]="color" (selected)="selectColor($event)" class="color-picker" hideEmptyUsedColors>
      <mcc-color-picker-collection [colors]="_colorService.colors()" hideEmpty="true"></mcc-color-picker-collection>
    </mcc-color-picker>
    Colorize node
  </button>
  <button mat-menu-item class="menu-item" (click)="resetParameters()" [class.disabled]="linkedNode">
    <fa-icon class="menu-icon" icon="eraser"></fa-icon> Reset parameters
  </button>
  <button mat-menu-item class="menu-item" (click)="deleteNode()">
    <fa-icon class="menu-icon" icon="trash-alt"></fa-icon> Delete node
  </button>
</mat-menu>

<mat-menu #levelMenu="matMenu" class="menu level-menu">
  <button mat-menu-item class="menu-item" (click)="setLevel(1)">
    <span>Rookie</span>
  </button>
  <button mat-menu-item class="menu-item" (click)="setLevel(2)">
    <span>Beginner</span>
  </button>
  <button mat-menu-item class="menu-item" (click)="setLevel(3)">
    <span>Advanced</span>
  </button>
  <button mat-menu-item class="menu-item" (click)="setLevel(4)">
    <span>Expert</span>
  </button>
</mat-menu>

<mat-menu #linkNodeMenu="matMenu" class="menu link-node-menu">
  <mat-list style="display:flex; padding:0;">
    <ng-container *ngFor="let otherNode of nodes">
      <mat-list-item style="width:48px; height:32px; line-height:32px; font-size:13px;" [style.border-color]="_colorService.node(otherNode)">
        <svg width="40" height="40">
          <g app-node-shape [idx]="otherNode.idx" (click)="linkModel(collection(otherNode.idx).model)" transform="translate(20,20)"></g>
        </svg>
      </mat-list-item>
    </ng-container>
  </mat-list>
</mat-menu>

<ng-container *ngIf="idx != undefined && isSelected()">

  <span class="controller node-controller">

    <span [class.dark-theme]="advanced()">
      <mat-toolbar color="primary" style="height:40px; opacity:0.8" [style.background-color]="advanced() ? '' : _colorService.node(node)">
        <span style="display:inherit; margin-left:-8px; margin-right: 10px">
          <svg width="40" height="40">
            <g app-node-shape
              (click)="selectNode(node)"
              [color]="_colorService.node(node)"
              [elementType]="collection().element_type"
              [idx]="idx"
              [spatial]="isSpatial()"
              transform="translate(20,20)"
            ></g>
          </svg>
        </span>

        <mat-select
            (selectionChange)="selectModel($event)"
            [matTooltip]="collection().element_type + ' model'"
            [(ngModel)]="data.simulation.models[model].existing"
            matTooltipPosition="before"
            style="font-size:14px"
          >
          <ng-container *ngFor="let model of models">
            <mat-option [value]="model.value">{{ model.label | capitalize }}</mat-option>
          </ng-container>
        </mat-select>

        <ng-container *ngIf="advanced()">
          <span style="margin-right:-16px" >
            <button mat-icon-button [matMenuTriggerFor]="nodeMenu"><fa-icon icon="ellipsis-v"></fa-icon></button>
          </span>
        </ng-container>
      </mat-toolbar>
    </span>


    <ng-container *ngIf="!isRecorder()">
      <mat-nav-list dense style="padding: 0">
        <ng-container *ngIf="!isSpatial()">
          <mat-list-item class="list-item" [style.border-color]="color" [style.display]="paramDisplay(node, 'n') ? '' : 'None'" >
            <app-input-popup
            (inputChange)="onNodeChange($event)"
            [value]="collection().n"
            [options]="_networkConfigService.config['node'].npop"
            class="input"
            view="valueSlider"
            ></app-input-popup>
          </mat-list-item>
        </ng-container>

        <ng-container *ngIf="isSpatial()">
            <mat-list-item class="list-item" [style.border-color]="color">
              <app-node-spatial [node]="node" [collection]="collection()" (spatialChange)="onSpatialChange($event)"></app-node-spatial>
            </mat-list-item>
        </ng-container>
      </mat-nav-list>
    </ng-container>

    <mat-nav-list dense style="padding:0">

      <ng-container *ngIf="!linkedNode">
        <ng-container *ngFor="let param of configModel.params">
          <mat-list-item class="list-item" [style.border-color]="color" [style.display]="paramDisplay(data.app.models[model], param.id) ? '' : 'None'" >
            <app-input-popup
              (inputChange)="onParamChange(param.id, $event)"
              [model]="data.simulation.models[model].existing"
              [options]="param"
              [value]="data.simulation.models[model].params[param.id]"
              [view]="param.input"
              class="input"
            ></app-input-popup>
          </mat-list-item>
        </ng-container>
      </ng-container>

    </mat-nav-list>

    <mat-list dense style="padding:0">
      <mat-list-item class="list-item" style="height:40px" [style.border-color]="color" [style.display]="data.simulation.models[model].existing == 'multimeter' ? '' : 'None'" >
        <mat-form-field style="width:100%">
          <mat-label>Record from</mat-label>
          <mat-select [(ngModel)]="record_from" multiple (selectionChange)="onRecordChange()">
            <ng-container *ngFor="let recordable of recordables">
              <mat-option [value]="recordable">{{ recordable }}</mat-option>
            </ng-container>
          </mat-select>
        </mat-form-field>
      </mat-list-item>

    </mat-list>

  </span>

</ng-container>
