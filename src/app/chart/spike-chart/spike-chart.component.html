<mat-card class="chart" [style.display]="_chartService.show ? '' : 'none'">
  <mat-card-subtitle class="chart-header">
    <span style="margin:5px">Spike chart for:</span>
    <mat-chip-list style="margin: 0 2px;">
      <span *ngFor="let neuron of neurons">
        <mat-chip class="neuron mat-accent" selected="true" (click)="_chartService.select(neuron)" [style.color]="_colorService.node(neuron)" [style.border-color]="_colorService.node(neuron)" [class.colored]="_chartService.isSelected(neuron)" [class.selected]="_sketchService.isSelectedNode(neuron)">
          <!-- <span style="margin-right:3px">{{ neuron.model }}</span> -->
          <span *ngIf="neuron.global_ids.length==1">[{{neuron.global_ids}}]</span>
          <span *ngIf="neuron.global_ids.length>1">[{{neuron.global_ids[0]}}..{{neuron.global_ids[neuron.global_ids.length-1]}}]</span>
        </mat-chip>
      </span>
      <mat-chip class="mat-accent" selected="true" (click)="selectAll()">all</mat-chip>
      <mat-chip class="mat-accent" selected="true" (click)="selectNone()">none</mat-chip>
    </mat-chip-list>

    <span class="floatRight" style="display:flex">
      <div class="no-print">
        <button mat-icon-button type="button" (click)="sidenavOpened=!sidenavOpened" class="mat-primary">
          <fa-icon icon="bars"></fa-icon>
        </button>
      </div>

      <button mat-icon-button class="node" [style.border-color]="color" [class.selected]="_sketchService.isSelectedNode(recorder)" (click)="_sketchService.toggleSelectNode(recorder)">
        {{ recorder.idx }}
      </button>
    </span>
  </mat-card-subtitle>

  <mat-card-content>
    <mat-sidenav-container hasBackdrop="false">
      <mat-sidenav class="chart-sidenav" role="region" mode="over" [opened]="sidenavOpened" position="end" style="width:345px" autoFocus="false">
        <mat-list class="chart-menu" dense>
          <mat-list-item mat-subheader>Subchart configuration</mat-list-item>

          <mat-list-item>
            <mat-form-field class="select">
              <mat-select [(value)]="subchart" placeholder="Subchart" (selectionChange)="rescaleY()">
                <mat-option value="none">No subchart</mat-option>
                <mat-option value="psth line">PSTH line</mat-option>
                <mat-option value="psth area">PSTH area</mat-option>
                <mat-option value="psth bar overlap">PSTH bar (group)</mat-option>
                <mat-option value="psth bar stack">PSTH bar (stack)</mat-option>
              </mat-select>
            </mat-form-field>
          </mat-list-item>

          <ng-container *ngIf="subchart.includes('psth')">
            <mat-divider></mat-divider>
            <mat-list-item mat-subheader>PSTH configuration</mat-list-item>

            <mat-list-item>
              <mat-form-field class="select">
                <mat-select [(value)]="ordinate" placeholder="Ordinate">
                  <mat-option value="count">Spike count</mat-option>
                  <mat-option value="rate">Firing rate [Hz]</mat-option>
                </mat-select>
              </mat-form-field>
            </mat-list-item>

            <mat-list-item>
              <app-ticks-slider
              (valueChange)="onChange($event)"
              [options]="_configService.config.app.slider.nbins"
              [value]="nbins"
              style="width:100%"
              ></app-ticks-slider>
            </mat-list-item>

            <mat-list-item *ngIf="!subchart.includes('bar')">
              <app-value-slider
                (valueChange)="overlap=$event"
                [options]="_configService.config.app.slider.overlap"
                [value]="overlap"
                style="width:100%"
              ></app-value-slider>
            </mat-list-item>

            <mat-list-item *ngIf="!subchart.includes('bar')">
              <app-value-slider
                (valueChange)="opacity=$event"
                [options]="_configService.config.app.slider.opacity"
                [value]="opacity"
                style="width:100%"
              ></app-value-slider>
            </mat-list-item>
          </ng-container>
        </mat-list>
      </mat-sidenav>

      <mat-sidenav-content class="chart-content">
        <app-scatter-chart
          [data]="data"
          [height]="scatter.height"
          [options]="scatter.options"
          [xDomain]="xDomain"
          [xScale]="_chartService.xScale"
          [yDomain]="yDomain"
          [yScale]="scatter.yScale"
          xLabel="Time [ms]"
          yLabel="Neuron"
          ></app-scatter-chart>

        <app-psth-chart *ngIf="subchart.includes('psth')"
          [chart]="subchart"
          [height]="psth.height"
          [data]="data"
          [nbins]="nbins"
          [options]="psth.options"
          [ordinate]="ordinate"
          [overlap]="overlap"
          [opacity]="opacity"
          [xScale]="_chartService.xScale"
          [yScale]="psth.yScale"
          ></app-psth-chart>
      </mat-sidenav-content>

    </mat-sidenav-container>
  </mat-card-content>
</mat-card>
